<UserControl x:Class="QuizApp.WPF.Views.Admin.AssignQuizzesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:conv="clr-namespace:QuizApp.WPF.Converters"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="900">

    <!-- Resources -->
    <UserControl.Resources>
        <conv:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*"/>
            <ColumnDefinition Width="16"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <!-- Users DataGrid -->
        <Border Grid.Column="0" Background="#1E293B" CornerRadius="8" Padding="16" BorderBrush="#334155" BorderThickness="1">
            <StackPanel>
                <TextBlock Text="🧑‍💼 Users" FontSize="18" FontWeight="Bold" Foreground="#F1F5F9" Margin="0,0,0,12"/>
                <DataGrid ItemsSource="{Binding Users}" SelectedItem="{Binding SelectedUser}" AutoGenerateColumns="False"
                          CanUserAddRows="False" HeadersVisibility="Column" RowBackground="#1E293B"
                          AlternatingRowBackground="#273449" Foreground="#F1F5F9" GridLinesVisibility="None"
                          Height="400">

                    <!-- Username Column -->
                    <DataGridTextColumn Header="Username" Binding="{Binding Username}" Width="*"/>
                    <!-- Role Column -->
                    <DataGridTextColumn Header="Role" Binding="{Binding Role}" Width="*"/>
                    <!-- Assign Button Column -->
                    <DataGridTemplateColumn Header="Assign Quizzes" Width="150">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Assign" Width="100" Height="28"
                                        Command="{Binding DataContext.OpenAssignQuizzesCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                </DataGrid>
            </StackPanel>
        </Border>

        <!-- Flyout Panel for Quizzes -->
        <Border Grid.Column="2" Background="#1E293B" CornerRadius="8" Padding="16" BorderBrush="#334155" BorderThickness="1"
                HorizontalAlignment="Right" VerticalAlignment="Top" Width="300" Height="400"
                Visibility="{Binding IsQuizPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}">

            <StackPanel>
                <TextBlock Text="{Binding SelectedUser.Username, StringFormat='Assign Quizzes to {0}'}"
                           FontSize="16" FontWeight="Bold" Foreground="#F1F5F9" Margin="0,0,0,12"/>

                <ScrollViewer Height="300">
                    <ItemsControl ItemsSource="{Binding Quizzes}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <CheckBox Content="{Binding Title}" 
                                          IsChecked="{Binding IsSelectedForAssignment, Mode=TwoWay}" 
                                          Foreground="#F1F5F9"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <Button Content="Assign Selected Quizzes" Width="180" Height="32" Margin="0,12,0,0"
                        Command="{Binding AssignSelectedQuizzesCommand}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
